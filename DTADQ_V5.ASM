list p=16F84A
#include <p16F84A.inc>

__CONFIG _CP_OFF & _WDT_OFF & _PWRTE_ON & _XT_OSC

CBLOCK	0X0C
	DATOA
	ADCNT
	CounterA
	CounterB
	CounterC
ENDC

#DEFINE	DATA_A	PORTA, RA0
#DEFINE	CLKC	PORTA, RA1
#DEFINE RSTC	PORTA, RA2

START	BSF	STATUS, RP0
	MOVLW	0X01
	MOVWF	TRISA
	CLRF	TRISB
	BCF	STATUS, RP0

MAIN	CLRF	DATOA
	CLRF	PORTB

	MOVLW	0X07
	MOVWF	ADCNT
	
	CALL	RST
	CALL	CHRGA

	MOVF	DATOA, W
	MOVWF	PORTB

	CALL	DELAY

	GOTO	MAIN

CHRGA	BTFSS	DATA_A
	GOTO	A_00
	GOTO	A_01
	
A_00	BCF	DATOA, 7
	RRF	DATOA, F

	BCF	STATUS, C
	
	GOTO	BCADQA

A_01	BSF	DATOA, 7
	RRF	DATOA, F

	BCF	STATUS, C
	
	GOTO	BCADQA

BCADQA	CALL 	CLK
	DECFSZ	ADCNT, F
	GOTO	CHRGA
	BTFSS	DATA_A
	GOTO	A_10
	GOTO	A_11

A_10	BCF	DATOA, 7
	RETURN 

A_11	BSF	DATOA, 7
	RETURN 

RST	BCF	RSTC

	NOP
	NOP
	NOP

	BSF	RSTC

	NOP
	NOP
	NOP

	BCF	RSTC

	RETURN 

CLK	BSF	CLKC
	
	NOP
	NOP
	NOP

	BCF	CLKC
		
	NOP
	NOP
	NOP
	
	BSF	CLKC

	RETURN

DELAY	MOVLW	D'16'
	MOVWF	CounterC
	MOVLW	D'55'
	MOVWF	CounterB
	MOVLW	D'201'
	MOVWF	CounterA

LOOP	DECFSZ	CounterA, F
	GOTO	LOOP
	DECFSZ	CounterB, F
	GOTO	LOOP
	DECFSZ	CounterC, F
	GOTO	LOOP
	RETURN

END